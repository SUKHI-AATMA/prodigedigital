<!-- https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=PLtqq1GxUPU6vyiljnFUiyd9wgrWxt_Og_&key=AIzaSyCg_dLOkBCPyypsKqjTuBcQIl-vdpkWaSA -->
<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <section class="page">
        <header>
            <div class="container">
                <div class="lftSec">
                    <div class="logo"><a href=""><img src="images/cooltoonz.png" alt=""></a></div>
                    <div class="yt_subscribe"><a href=""><img src="images/yt-subscribe.png" alt=""></a></div>
                </div>
                <div class="kradle2crayons"><a href=""><img src="images/kradle_2_crayons.png" alt=""></a></div>
            </div>
        </header>
        <section class="content">
            <div class="container">
                <div class="title">WELCOME TO COOLTOONZ.TV</div>
                <div class="message">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which donâ€™t look even slightly believable.</div>
                <div id="list"></div>
            </div>
        </section>
        <section class="player" id="player">
            <!-- <a href="#javascript:;" class="pauseVideo" onclick="pauseVideo()">Pause</a>
            <a href="#javascript:;" class="stopVideo" onclick="stopVideo()">Stop</a> -->
        </section>
        <footer>&copy; Designed and developed line by June Digital</footer>
    </section>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
    // 2. This code loads the IFrame Player API code asynchronously.
    // var tag = document.createElement('script');

    // tag.src = "https://www.youtube.com/iframe_api";
    // var firstScriptTag = document.getElementsByTagName('script')[0];
    // firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    $.ajax({
        type: 'GET',
        url: 'https://www.googleapis.com/youtube/v3/playlistItems',
        data: {
            key: 'AIzaSyCg_dLOkBCPyypsKqjTuBcQIl-vdpkWaSA',
            playlistId: "PLd3QWWNm6BIODOWqzR9_F6tkzR9bso4rh",
            part: 'snippet',
            maxResults: 50,
            type: 'video',
            videoEmbeddable: true,
        },
        success: function(data) {
            // embedVideo(data)
            // data.items.forEach(function(ite, index) {
            // console.log(data.items);
            // console.log(vidId);
            // divEle = 'player'+index;
            // $('#list').append('<div id="' + vidId + '"></div>');
            var vidId = '';
            var divPlayer = '';
            data.items.forEach(function(data, index) {
                // console.log()
                if (index == 0) {
                    vidId = data.snippet.resourceId.videoId;
                }
                // var imgUrl = imgUrl.default.url;
                var imgUrl = data.snippet.thumbnails;
                divPlayer += '<div id="' + data.snippet.resourceId.videoId + '" class="videoS" data-title="' + data.snippet.title + '">'
                divPlayer += '<div class="img"><img src="' + imgUrl.high.url + '" alt="' + data.snippet.title + '"></div>';
                divPlayer += '<h3>' + data.snippet.title + '</h3>';
                divPlayer += '<a href="javascript:;" class="quizBtn">Take the Quiz</a></div>';
                // divPlayer += '</div>';

            });
            $('#list').append(divPlayer);

            var player;
            // onYouTubeIframeAPIReadyss(vidId);
            // exit;
            // embedVideo(vidId);
            $('.img').on('click', function() {
                var viddd = $(this).parents('.videoS').attr('id'),
                    title = $(this).parents('.videoS').attr('data-title');
                // console.log(viddd);
                $('.content').fadeOut(300).siblings('.player').fadeIn(300);
                embedVideo(viddd, title);
                $('.page').animate({ scrollTop: $('header').outerHeight() }, 500);
                $('.tkQuiz').on('click', function() {
                    // alert(1);
                    $(this).hide();
                    $('.q').show();
                    setTimeout(function() { $('.page').animate({ scrollTop: ($('.quiz').offset().top) }, 500); }, 500)
                });
            })
            $('.quizBtn').on('click', function() {
                $(this).siblings('.img').trigger('click');
                $('.tkQuiz').hide();
                $('.q').show();
                setTimeout(function() { $('.page').animate({ scrollTop: ($('.quiz').offset().top) }, 500); }, 500)
            });
            // });
        },
        error: function(vidId, title, description) {
            console.log("Request Failed");
        }
    });

    function onYouTubeIframeAPIReadyss(vidId) {
        player = new YT.Player('player', {
            height: '390',
            width: '640',
            videoId: vidId,
            playerVars: {
                'autoplay': 1,
                'controls': 0,
                'rel': 0,
                'fs': 0,
            },
            events: {
                // 'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    // 4. The API will call this function when the video player is ready.
    function onPlayerReady(event) {
        event.target.playVideo();
    }

    // 5. The API calls this function when the player's state changes.
    //    The function indicates that when playing a video (state=1),
    //    the player should play for six seconds and then stop.
    var done = false;

    function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PLAYING && !done) {
            // setTimeout(stopVideo, 65000);
            done = true;
        }
    }

    // function pauseVideo() {
    //     alert(player.getCurrentTime());
    //     player.pauseVideo();
    // }

    // function stopVideo() {
    //     alert(player.getCurrentTime());
    //     player.stopVideo();
    // }

    function embedVideo(vidId, title) {
        var divPlayer = '<div class="container">'
        divPlayer += `<div class="title">
            <p>` + title + `</p>
            <p>EP 1</p>
        </div>
        <div class="vid">
            <iframe width="1240" height="698" src="https://www.youtube.com/embed/` + vidId + `?autoplay=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <div class="quiz">
            <a href="javascript:;" class="submit tkQuiz">Take Quiz</a>
            <div class="q">
                <div class="qTitle">Answer the following question</div>
                <div class="questions">
                    
                    
                </div>
            </div>
        </div>
        `;
        // divPlayer += '<h3>'+data.title+'</h3>';
        // divPlayer += '<p>'+data.description+'</p>';
        divPlayer += '</div>';
        $('#player').html('').append(divPlayer);
        generateQuestions(vidId);
        
        // $('iframe').attr('src', )
        // $('h3').text(data.title)
        // $('.description').text(data.description)
    }
    
    function generateQuestions(vId) {
        var questions = '', aCount = 0, qCount = 0;
        $.ajax({
            type: "GET",
            url: "data.json",
            // url: "https://api.sheetson.com/v2/sheets/Sheet1",
            // header: {
            //     'Content-Type': 'application/json',
            //     'Authentication': 'Bearer KJf__UZEaJl7EXTxdhq2pDm5reXlL_xiHecfZN62ipLQ6IMG4Pa01ZXU7gE',
            //     "X-Spreadsheet-Id": "1N2qTmC8AIoa7hlQkKJ4yun-8WVnUCMgI2shyknSkBps"
            // },
            // KJf__UZEaJl7EXTxdhq2pDm5reXlL_xiHecfZN62ipLQ6IMG4Pa01ZXU7gE
            // data: data,
            success: function(response) {
                console.log(response);
                response.forEach(function(response) {
                    if(response.vidId == vId)
                    {
                        console.log(1);
                        var answers = response.answers.split("|");
                        // .trim()
                        var ans = '';
                        var nameCount = 'que' + (qCount++)
                        answers.forEach(function(data, index) {
                            var forID = 'rd' + (aCount++);
                            ans += `<label for="` + forID + `">
                                        <input type="radio" id="` + forID + `" name="`+nameCount+`" value="` + answers[index].trim() + `"> ` + answers[index].trim() + `<span class="chk"></span></label>`;
                        });
                        questions += `<div class="que">
                            <h4 data-cor="` + response.correct + `">Q`+(qCount) + `. ` + response.questions + `</h4>
                            <div class="opts">
                                ` + ans + `
                            </div>
                        </div>`
                    }
                });
                questions += '<a href="javascript:;" class="submit submitF">Submit</a>';
                console.log(questions)
                // return questions;
                $('.questions').append(questions);
                $('.submitF').on('click',function(){
                    onSubmit()
                });
            },
            error: function(response) {
                
            },
            complete: function(response) {}
        });
    }

    function onSubmit(){
        var queLen = $('.que').length, score = 0;
        $("[type='radio']:checked").map(function(){
            ($(this).val() == $(this).parents('.que').find('h4').attr('data-cor')) ? (score++) : '';
            // console.log('sel: ' + $(this).val() + ' Correct: '+ $(this).parents('.que').find('h4').attr('data-cor')  + ' Scrore: '+ score);
        });
        alert("Your Scrore is "+score+" / 5")
        // .val();
        // console.log($(this).val())
    }
    </script>
</body>

</html>